<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'Abysse du Vide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;400;700&family=Space+Mono&display=swap');
        
        :root {
            --bg-color: #020203;
            --text-color: #f8fafc;
            --accent: #6366f1;
            --panel-bg: rgba(15, 15, 20, 0.8);
            --border: rgba(255, 255, 255, 0.08);
        }

        .light-theme {
            --bg-color: #fcfcfd;
            --text-color: #0f172a;
            --accent: #4f46e5;
            --panel-bg: rgba(240, 240, 245, 0.8);
            --border: rgba(0, 0, 0, 0.08);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Plus Jakarta Sans', sans-serif;
            transition: background-color 0.8s ease, color 0.8s ease;
            overflow: hidden;
            margin: 0;
        }

        .mono { font-family: 'Space Mono', monospace; }

        #canvas-particles {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 0;
            pointer-events: none;
        }

        /* Overlay d'entrée pour l'Audio */
        #entry-overlay {
            position: fixed;
            inset: 0;
            background: #020203;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 1s ease, visibility 1s;
        }

        .glass {
            background: var(--panel-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
        }

        .exp-bar-container {
            width: 100%;
            height: 4px;
            background: var(--border);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .exp-bar-fill {
            height: 100%;
            background: var(--accent);
            box-shadow: 0 0 15px var(--accent);
            transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .timer-circle {
            position: relative;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.05) 0%, transparent 70%);
        }

        .timer-circle::before {
            content: '';
            position: absolute;
            inset: -10px;
            border: 1px solid var(--border);
            border-radius: 50%;
            animation: pulse 4s infinite alternate ease-in-out;
        }

        @keyframes pulse {
            from { transform: scale(1); opacity: 0.3; }
            to { transform: scale(1.05); opacity: 0.1; }
        }

        .settings-panel {
            transform: translateX(100%);
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .settings-panel.open { transform: translateX(0); }

        .btn-tab.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .tab-content {
            width: 100%;
            max-width: 600px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
        }

        /* Scrollbar styling */
        .tab-content::-webkit-scrollbar { width: 4px; }
        .tab-content::-webkit-scrollbar-track { background: transparent; }
        .tab-content::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen">

    <!-- Overlay d'initialisation -->
    <div id="entry-overlay">
        <div class="text-center space-y-8">
            <h1 class="text-4xl font-extralight tracking-[0.5em] text-white">L'ABYSSE</h1>
            <button onclick="startExperience()" class="px-10 py-4 border border-white/20 text-white tracking-widest text-xs hover:bg-white hover:text-black transition-all duration-500 rounded-full">
                ENTRER DANS LE VIDE
            </button>
        </div>
    </div>

    <canvas id="canvas-particles"></canvas>

    <!-- UI Principale -->
    <div id="main-ui" class="relative z-10 flex flex-col items-center justify-between min-h-screen p-8 opacity-0 transition-opacity duration-1000">
        
        <!-- Top Bar -->
        <div class="w-full flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="h-8 w-[1px] bg-indigo-500"></div>
                <span class="text-[10px] tracking-[0.4em] uppercase text-gray-500">Status: Existant</span>
            </div>
            <button onclick="toggleSettings()" class="p-2 hover:rotate-90 transition-transform duration-500">
                <svg class="w-5 h-5 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="1.5" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path></svg>
            </button>
        </div>

        <!-- Center -->
        <div class="flex flex-col items-center gap-12">
            <div class="text-center space-y-4">
                <div class="timer-circle">
                    <div class="flex flex-col items-center">
                        <span id="main-timer" class="text-6xl font-extralight tracking-tighter mono">00:00:00</span>
                        <div class="exp-bar-container w-48 mt-8">
                            <div id="exp-bar" class="exp-bar-fill" style="width: 0%"></div>
                        </div>
                        <span class="text-[9px] uppercase tracking-[0.4em] text-gray-500 mt-4">Niveau <span id="lvl-txt">1</span> • <span id="exp-txt">0</span> XP</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="w-full flex flex-col items-center gap-4">
            <div id="tab-achievements" class="tab-content text-center">
                <p class="text-[10px] uppercase tracking-widest text-gray-500">Vos accomplissements apparaîtront ici.</p>
            </div>
            <div id="tab-collection" class="tab-content hidden text-center">
                <p class="text-[10px] uppercase tracking-widest text-gray-500">Votre collection est vide pour le moment.</p>
            </div>

            <!-- Footer / Tabs -->
            <div class="w-full max-w-xl glass p-1 rounded-full flex gap-2">
                <button onclick="setTab('achievements')" id="tab-ach-btn" class="btn-tab active flex-1 py-3 rounded-full text-[11px] uppercase tracking-widest transition-all">Succès</button>
                <button onclick="setTab('collection')" id="tab-col-btn" class="btn-tab flex-1 py-3 rounded-full text-[11px] uppercase tracking-widest transition-all">Collection</button>
            </div>
        </div>
    </div>

    <!-- Settings Panel -->
    <div id="settings" class="settings-panel fixed top-0 right-0 h-full w-80 glass z-50 p-10 flex flex-col gap-10">
        <div class="flex justify-between items-center">
            <h2 class="text-xs uppercase tracking-[0.3em] font-bold">Configuration</h2>
            <button onclick="toggleSettings()" class="text-gray-500 hover:text-white">✕</button>
        </div>

        <div class="space-y-6">
            <label class="text-[10px] uppercase text-gray-500 tracking-widest">Atmosphère</label>
            <div class="grid grid-cols-2 gap-2">
                <button onclick="setTheme('dark')" id="t-dark" class="py-2 border border-indigo-500 bg-indigo-500/10 text-[10px] rounded uppercase tracking-tighter">Abysse</button>
                <button onclick="setTheme('light')" id="t-light" class="py-2 border border-transparent hover:border-white/10 text-[10px] rounded uppercase tracking-tighter">Éclat</button>
            </div>
        </div>

        <div class="space-y-6">
            <label class="text-[10px] uppercase text-gray-500 tracking-widest">Volume Audio</label>
            <input type="range" id="vol-slider" min="0" max="1" step="0.01" value="0.5" class="w-full accent-indigo-500">
        </div>

        <div class="mt-auto text-[9px] text-gray-600 uppercase tracking-widest text-center">
            © 2024 • Fréquence du Vide
        </div>
    </div>

    <script>
        let state = {
            seconds: 0,
            level: 1,
            exp: 0,
            theme: 'dark',
            volume: 0.5,
            started: false
        };

        // --- MOTEUR AUDIO MODERNE ---
        let audioCtx, masterGain, drone, heartbeat, shimmer;

        function initModernAudio() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            masterGain = audioCtx.createGain();
            masterGain.gain.value = 0;
            masterGain.connect(audioCtx.destination);

            // 1. Drone Basse Profonde
            drone = audioCtx.createOscillator();
            const droneGain = audioCtx.createGain();
            drone.type = 'sine';
            drone.frequency.value = 43.65; // F1
            droneGain.gain.value = 0.4;
            drone.connect(droneGain).connect(masterGain);
            drone.start();

            // 2. Heartbeat (Sub-bass pulse)
            const createPulse = () => {
                if(!state.started) return;
                const osc = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                osc.frequency.setValueAtTime(50, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(20, audioCtx.currentTime + 0.5);
                g.gain.setValueAtTime(0.3 * state.volume, audioCtx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.connect(g).connect(audioCtx.destination);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.6);
                setTimeout(createPulse, 2000 + Math.random() * 500);
            };
            createPulse();

            // 3. Shimmer (Filtre de bruit pour texture)
            const bufferSize = 2 * audioCtx.sampleRate;
            const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const output = noiseBuffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) { output[i] = Math.random() * 2 - 1; }
            
            const noise = audioCtx.createBufferSource();
            noise.buffer = noiseBuffer;
            noise.loop = true;
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 400;
            const noiseGain = audioCtx.createGain();
            noiseGain.gain.value = 0.05;
            
            noise.connect(filter).connect(noiseGain).connect(masterGain);
            noise.start();

            masterGain.gain.setTargetAtTime(state.volume * 0.5, audioCtx.currentTime, 2);
        }

        function startExperience() {
            state.started = true;
            initModernAudio();
            document.getElementById('entry-overlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('entry-overlay').style.visibility = 'hidden';
                document.getElementById('main-ui').style.opacity = '1';
            }, 1000);
            
            // Start Logic
            setInterval(update, 1000);
            initParticles();
            animateParticles();
        }

        // --- PARTICULES ---
        const canvas = document.getElementById('canvas-particles');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function initParticles() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = Array.from({length: 80}, () => ({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 1.5,
                vx: (Math.random() - 0.5) * 0.3,
                vy: (Math.random() - 0.5) * 0.3,
                a: Math.random()
            }));
        }

        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const color = state.theme === 'dark' ? 255 : 0;
            particles.forEach(p => {
                p.x += p.vx; p.y += p.vy;
                if(p.x < 0) p.x = canvas.width; if(p.x > canvas.width) p.x = 0;
                if(p.y < 0) p.y = canvas.height; if(p.y > canvas.height) p.y = 0;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                ctx.fillStyle = `rgba(${color}, ${color}, ${color}, ${p.a * 0.3})`;
                ctx.fill();
            });
            requestAnimationFrame(animateParticles);
        }

        // --- LOGIQUE CORE ---
        function update() {
            state.seconds++;
            state.exp += 2;
            let req = 100 * Math.pow(1.3, state.level - 1);
            if(state.exp >= req) {
                state.exp -= req;
                state.level++;
            }

            // Update UI
            const h = Math.floor(state.seconds / 3600).toString().padStart(2, '0');
            const m = Math.floor((state.seconds % 3600) / 60).toString().padStart(2, '0');
            const s = (state.seconds % 60).toString().padStart(2, '0');
            const timerEl = document.getElementById('main-timer');
            if(timerEl) timerEl.textContent = `${h}:${m}:${s}`;
            
            const expBarEl = document.getElementById('exp-bar');
            if(expBarEl) expBarEl.style.width = `${(state.exp / req) * 100}%`;
            
            const lvlTxtEl = document.getElementById('lvl-txt');
            if(lvlTxtEl) lvlTxtEl.textContent = state.level;
            
            const expTxtEl = document.getElementById('exp-txt');
            if(expTxtEl) expTxtEl.textContent = Math.floor(state.exp);
        }

        // --- GESTION DES ONGLETS (CORRECTION) ---
        function setTab(tabName) {
            const isAch = tabName === 'achievements';
            
            // Toggle visibility
            document.getElementById('tab-achievements').classList.toggle('hidden', !isAch);
            document.getElementById('tab-collection').classList.toggle('hidden', isAch);
            
            // Toggle button states
            document.getElementById('tab-ach-btn').classList.toggle('active', isAch);
            document.getElementById('tab-col-btn').classList.toggle('active', !isAch);
        }

        function setTheme(t) {
            state.theme = t;
            document.body.className = t === 'light' ? 'light-theme' : '';
            document.getElementById('t-dark').style.borderColor = t === 'dark' ? '#6366f1' : 'transparent';
            document.getElementById('t-light').style.borderColor = t === 'light' ? '#6366f1' : 'transparent';
        }

        function toggleSettings() {
            document.getElementById('settings').classList.toggle('open');
        }

        document.getElementById('vol-slider').addEventListener('input', (e) => {
            state.volume = e.target.value;
            if(masterGain) masterGain.gain.setTargetAtTime(state.volume * 0.5, audioCtx.currentTime, 0.1);
        });

        window.addEventListener('resize', initParticles);
    </script>
</body>
</html>
